{% extends "base.html" %}

{% load static %}
{% load active_link_tags %}
{% load i18n %}
{% block title %}Аналитика по пользователям{% endblock %}

{% block content %}

<header>
  <div class="container d-flex justify-content-between align-items-center py-3">
    <nav class="my-auto nav-item dropdown">
      <a href="{% url 'stats:region_statistics' %}" class="{% if view_name == 'stats:region_statistics' %}active{% endif %}">{% trans "Регионы" %}</a>
      <a href="{% url 'stats:team_statistics' %}" class="{% if view_name == 'stats:region_statistics' %}active{% endif %}">{% trans "Команды" %}</a>
      <a href="{% url 'stats:user_statistics' %}" class="{% if view_name == 'stats:region_statistics' %}active{% endif %}">{% trans "Участники" %}</a>
    </nav>
  </div>
</header>
<h2>Аналитика по командам</h2>
<table>
  <thead>
  <tr>
    <th>Команда</th>
    <th>Количество результатов</th>
  </tr>
  </thead>
  <tbody>
  {% for stat in team_stats %}
  <tr>
    <td>{{ stat.team__name }}</td>
    <td>{{ stat.total }}</td>
  </tr>
  {% endfor %}
  </tbody>
</table>

<script src="{% static '/js/chart.js' %}"></script>
<canvas id="teamStatsChart" width="400" height="200"></canvas>
<script>
    const teamData = {{ team_stats|safe }};

    const labels = teamData.map(item => item.team__name);
    const data = teamData.map(item => item.total);

    const ctx = document.getElementById('teamStatsChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Количество мероприятий',
                data: data,
                backgroundColor: 'rgba(75, 192, 192, 0.5)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1,
                tension: 0.4,
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>

{% endblock %}
